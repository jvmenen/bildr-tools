/* Copyright 2022, Jeroen van Menen. bildr-tools 0.4.3 (Wed, 06 Jul 2022 07:06:22 GMT) */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Bildr=t():(e.Bildr=e.Bildr||{},e.Bildr.plugins=t())}(self,(()=>(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{PluginBase:()=>n,PluginLeftSide:()=>r,SimplePluginAction:()=>s,initPluginManagerUI:()=>a,manager:()=>i});class i{constructor(){this._registeredPlugins=[]}register(e){if(null==e.name||null==e.name||0==e.name.trim().length)throw new Error("Name is required to register a plugin.");if(i.isRegistered(e.name))throw new Error(`Plugin with name '${e.name}' already registered. Name needs to be unique.`);this.startListeningForMessagesFromIFrame(),this._registeredPlugins.push(e),e.renderPage()}isRegistered(e){return null!=this._registeredPlugins.find((t=>t.name==e))}showPlugin(e){let t=this._registeredPlugins.find((t=>t.name==e));null!=t&&t.show()}remove(e){let t=this._registeredPlugins.find((t=>t.name==e));null!=t&&(t.remove(),this._registeredPlugins.forEach(((e,i)=>{e===t&&this._registeredPlugins.splice(i,1)})))}get window(){return window}startListeningForMessagesFromIFrame(){0==this._registeredPlugins.length&&this.window.addEventListener("message",(e=>{this.triggerActionInPlugin(e)}))}triggerActionInPlugin(e){if(!e.data)throw new Error("e.data property is missing.");let t=e.data;if(!t.pluginName)throw new Error("Required property e.data.pluginName is missing.");if(!t.command)throw new Error("Required property e.data.command is missing.");if(!t.uMsgId)throw new Error("Required property e.data.uMsgId is missing.");let i=this._registeredPlugins.find((e=>t.pluginName&&e.name==t.pluginName));if(null==i)throw new Error(`Plugin with name '${t.pluginName}' is not registered.`);null==t.data&&(t.data={}),t.data.uMsgId=t.uMsgId,i.triggerAction(t.command,t.data)}getVisiblePlugins(){return this._registeredPlugins.filter((e=>e.isVisible))}static getInstance(){return null==this._instance&&(this._instance=new i),this._instance}static remove(e){this.getInstance().remove(e)}static isRegistered(e){return this.getInstance().isRegistered(e)}static register(e){this.getInstance().register(e)}static getVisiblePlugins(){return this.getInstance().getVisiblePlugins()}static showPlugin(e){this.getInstance().showPlugin(e)}}class s{constructor(e,t){this._name=e,this._execFunc=t}get name(){return this._name}execFunc(e){return this._execFunc(e)}}class n{constructor(e,t){this._actions=[],this._name=e,this._pageUrl=t,this._divId=Math.random().toString(16).slice(2),this._frameId=Math.random().toString(16).slice(2)}get name(){return this._name}isSameDivElem(e){return this._divElem===e}get divElem(){return this._divElem}sendOutgoingMessage(e,t){if(null==this._frameId||null==this._frameId||""==this._frameId)throw new Error("this._frameId should be set in the context of sendOutgoingMessage");document.getElementById(this._frameId).contentWindow.postMessage({msgId:e,result:t},"*")}triggerAction(e,t){let i=this._actions.find((t=>t.name==e));if(null==i)throw new Error(`Unknown action '${e}' on plugin '${this.name}'`);let s=i.execFunc(t);if(s){if(null==t.uMsgId||null==t.uMsgId||""==t.uMsgId)throw new Error("uMsgId is required and should be set on Data");this.sendOutgoingMessage(t.uMsgId,s)}return s}hide(){this._divElem.style.right="-400px"}show(){this._divElem.style.width="400px",this._divElem.style.right="0px"}toggleVisibility(){this.isVisible?this.hide():this.show()}get isVisible(){return"0px"==this._divElem.style.right}get document(){return window.document}renderPage(){if(!this._divElem){let e=this.document.createElement("div");e.id=this._divId,e.style.cssText="width:0px;height:100vh;top:0px;left:unset;right:-400px;bottom:unset;border:none;background:#ffffff;position: fixed;z-index: 100010;overflow: hidden;position:absolute;transition: right 300ms ease-in-out 0s;",e.innerHTML=`<iframe id='${this._frameId}' src='${this.pageUrl}' style='all:unset;width:100%;height:100%;background-color:#292c33'></iframe>`,this.document.body.appendChild(e),e.addEventListener("transitionend",(t=>{"0px"!=e.style.right&&(e.style.width="0px")})),this._divElem=e}}get pageUrl(){return this._pageUrl}remove(){this.document.body.removeChild(this._divElem)}addActionObject(e){this._actions.push(e)}addAction(e,t){this.addActionObject(new s(e,t))}}class r extends n{constructor(e,t){super(e,t)}renderPage(){if(!this._divElem){let e=this.document.createElement("div");e.id=this._divId,e.style.cssText="width:0px;height:100vh;top:0px;left:-350px;right:unset;bottom:unset;border:none;background:#ffffff;position: fixed;z-index: 100004;overflow: hidden;position:absolute;transition: left 300ms ease-in-out 0s;",e.innerHTML=`<iframe id='${this._frameId}' src='${this.pageUrl}' style='all:unset;width:100%;height:100%';background-color:#292c33></iframe>`,this.document.body.appendChild(e),e.addEventListener("transitionend",(t=>{"53px"!=e.style.left&&(e.style.width="0px")})),this._divElem=e}}hide(){this._divElem.style.left="-350px"}show(){this._divElem.style.width="350px",this._divElem.style.left="53px"}get isVisible(){return"53px"==this._divElem.style.left}}Node.prototype.appendAfter=function(e){e.parentNode?.insertBefore(this,e.nextSibling)};class d extends r{constructor(){let e="";e="https://communityplugins.bildr.com/",super("BildrPluginsUI",e),this.addAction("hidePlugin",(()=>{this.hide()})),this.addActionObject(new l(document))}}class l{constructor(e){this._document=e}get name(){return"loadPluginScript"}execFunc(e){if(i.getVisiblePlugins().forEach((e=>{"BildrPluginsUI"!=e.name&&e.hide()})),i.isRegistered(e.pluginName))i.showPlugin(e.pluginName);else{var t=this._document.createElement("script");t.src=e.src,t.onload=()=>{i.showPlugin(e.pluginName)},this._document.head.appendChild(t)}}}class o{static isSideBarAvailable(){return document.querySelector(`.${o.sideMenuBarDivCss}`)}static create(){if(!document.getElementById(o.pluginsMenuItemDivId)){let s=new d;i.register(s);var e=document.createElement("div");e.id=o.pluginsMenuItemDivId,e.className="css_0Bn06MSFX0Oj13pgDAho9g ",e.innerHTML="<img src='https://documents-weu.bildr.com/r778fd6080b694ebc8451a3af0b77b028/doc/tool.5hBAqSf0U0aFZAloVaMjBw.svg' class='css_40tBJ8HulEaFxBAoX32hBQ' draggable='false' width='240'><div innerhtml='Community Plugins' class='css_ css_23185 css_22538 css_23641' style='white-space:nowrap;'>Community Plugins</div>";var t=document.querySelector(`.${o.sideMenuBarDivCss}`);if(null==t)throw new Error("Could not find side menu bar");let n=t.querySelectorAll(".css_jMrwOmSGxUezs1sr6VSoNQ  ")[5];n?n.before(e):t.appendChild(e),document.body.addEventListener("click",(e=>{var t=e.target;let n="hide",r=i.getVisiblePlugins();for(;t;){if(null==t)return;if(r.find((e=>e.isSameDivElem(t)))){n="";break}if(t.id==o.pluginsMenuItemDivId){n="toggle";break}t=t.parentNode}"hide"==n&&r.forEach((e=>e.hide())),"toggle"==n&&s.toggleVisibility()}),{capture:!0})}}}function a(){-1!=location.href.indexOf("https://www.bildr.com/studio?projectName=")&&function(){var e=[];return e.push(new MutationObserver((function(e,t){o.isSideBarAvailable()&&(t.disconnect(),o.create())}))),e}().forEach((e=>{e.observe(document,{childList:!0,subtree:!0})}))}return o.pluginsMenuItemDivId="bildrPluginsMenuItem",o.sideMenuBarDivCss="css_23071.css_23052",t})()));
//# sourceMappingURL=bildr-plugins.min.js.map