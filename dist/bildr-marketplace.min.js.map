{"version":3,"file":"bildr-marketplace.min.js","mappings":"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","sources":["webpack://Bildr/webpack/universalModuleDefinition","webpack://Bildr/webpack/bootstrap","webpack://Bildr/webpack/runtime/define property getters","webpack://Bildr/webpack/runtime/hasOwnProperty shorthand","webpack://Bildr/webpack/runtime/make namespace object","webpack://Bildr/./src/plugin/BildrPluginRightSide.ts","webpack://Bildr/./src/plugin/BildrPluginManager.ts","webpack://Bildr/./src/bildr-marketplace-plugin-v1.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Bildr\"] = factory();\n\telse\n\t\troot[\"Bildr\"] = root[\"Bildr\"] || {}, root[\"Bildr\"][\"marketplace\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\r\n/**\r\n * @public\r\n */\r\nexport interface BildrPluginAction {\r\n    get name(): string;\r\n    execFunc(args: any): any;\r\n}\r\n\r\n/**\r\n * @public\r\n */\r\nexport class BildrPluginRightSide {\r\n    protected _name: string;\r\n    protected _pageUrl: string;\r\n    protected _frameId: string;\r\n    protected _divElem!: HTMLDivElement;\r\n    protected _divId: string;\r\n    protected _actions: BildrPluginAction[] = []\r\n\r\n    constructor(name: string, pageUrl: string) {\r\n        this._name = name;\r\n        this._pageUrl = pageUrl;\r\n        this._divId = Math.random().toString(16).slice(2);\r\n        this._frameId = Math.random().toString(16).slice(2);\r\n    }\r\n\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    protected get divElem(): HTMLDivElement {\r\n        return this._divElem;\r\n    }\r\n    public isSameDivElem(divElem: HTMLElement) {\r\n        return this._divElem === divElem;\r\n    }\r\n\r\n    protected sendOutgoingMessage(msgId: string, result: any) {\r\n        var window = (document.getElementById(this._frameId) as HTMLIFrameElement).contentWindow;\r\n        window!.postMessage({\r\n            \"msgId\": msgId,\r\n            \"result\": result\r\n        }, \"*\");\r\n\r\n    }\r\n\r\n    public triggerAction(actionName: string, actionData: any) {\r\n        if (actionData.uMsgId == undefined || actionData.uMsgId == null || actionData.uMsgId == \"\") {\r\n            throw new Error(\"uMsgId should be set on argument actionData\");\r\n        }\r\n\r\n        let action = this._actions.find(item => item.name == actionName)\r\n        if (action == undefined) {\r\n            throw new Error(`Unknown action '${actionName}' on plugin '${this.name}'`);\r\n        }\r\n        let result = action.execFunc(actionData)\r\n        if (result) {\r\n            this.sendOutgoingMessage(actionData.uMsgId, result)\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public hide() {\r\n        this._divElem.style.right = \"-400px\";\r\n    }\r\n\r\n    public show() {\r\n        this._divElem.style.width = '400px';\r\n        this._divElem.style.right = '0px';\r\n    }\r\n\r\n    toggleVisibility() {\r\n        if (this.isVisible) {\r\n            this.hide();\r\n        } else {\r\n            this.show();\r\n        }\r\n    }\r\n\r\n    public get isVisible() {\r\n        return this._divElem.style.right == '0px';\r\n    }\r\n\r\n    protected get document(): Document {\r\n        return window.document;\r\n    }\r\n\r\n    public renderPage(): void {\r\n        if (!this._divElem) {\r\n            // CREATE plugin div/iframe\r\n            let elem = this.document.createElement('div');\r\n            elem.id = this._divId;\r\n            elem.style.cssText = \"width:0px;height:100vh;top:0px;left:unset;right:-400px;bottom:unset;border:none;background:#ffffff;position: fixed;z-index: 100010;overflow: hidden;position:absolute;transition: right 300ms ease-in-out 0s;\";\r\n            elem.innerHTML = `<iframe id='${this._frameId}' src='${this._pageUrl}' style='all:unset;width:100%;height:100%'></iframe>`;\r\n            // add to document (right side)\r\n            this.document.body.appendChild(elem);\r\n\r\n            // Animation end handler\r\n            elem.addEventListener('transitionend', _e => {\r\n                // when the animation is finished, \"hide\" it when out of view\r\n                // prevents UI issues when the Studio canvas is scaled\r\n                if (elem.style.right != '0px') { elem.style.width = '0px'; }\r\n            });\r\n\r\n            this._divElem = elem;\r\n        }\r\n    }\r\n\r\n    public remove(): void {\r\n        this.document.body.removeChild(this._divElem);\r\n    }\r\n\r\n    public addActionObject(action: BildrPluginAction): void {\r\n        this._actions.push(action)\r\n    }\r\n\r\n    public addAction(actionName: string, execFnc: Function): void {\r\n        this.addActionObject(new SimplePluginAction(actionName, execFnc));\r\n    }\r\n}\r\n\r\nclass SimplePluginAction implements BildrPluginAction {\r\n    public name: string;\r\n    private _execFunc: Function;\r\n\r\n    constructor(actionName: string, execFunc: Function) {\r\n        this.name = actionName;\r\n        this._execFunc = execFunc;\r\n    }\r\n\r\n    execFunc(args: any): any {\r\n        return this._execFunc(args);\r\n    }\r\n}\r\n","import { BildrPluginRightSide } from \"./BildrPluginRightSide\";\r\n\r\n/**\r\n * @public\r\n */\r\nexport class BildrPluginManager {\r\n    static _instance: BildrPluginManager;\r\n\r\n    private _registeredPlugins: BildrPluginRightSide[] = [];\r\n\r\n    constructor() { }\r\n\r\n    public register(plugin: BildrPluginRightSide) {\r\n        if (plugin.name == undefined || plugin.name == null || plugin.name.trim().length == 0) {\r\n            throw new Error(\"Name is required to register a plugin.\");\r\n        }\r\n        if (BildrPluginManager.isRegistered(plugin.name)) {\r\n            throw new Error(`Plugin with name '${plugin.name}' already registered. Name needs to be unique.`);\r\n        }\r\n\r\n        this.startListeningForMessagesFromIFrame();\r\n\r\n        this._registeredPlugins.push(plugin)\r\n        plugin.renderPage();\r\n    }\r\n\r\n    public isRegistered(pluginName: string): boolean {\r\n        return this._registeredPlugins.find(item => item.name == pluginName) != undefined\r\n    }\r\n\r\n    public showPlugin(pluginName: string) {\r\n        let plugin = this._registeredPlugins.find(item => item.name == pluginName)\r\n        if (plugin != undefined) {\r\n            plugin.show();\r\n        }\r\n    }\r\n    public remove(pluginName: string) {\r\n        let plugin = this._registeredPlugins.find(item => item.name == pluginName)\r\n        if (plugin != undefined) {\r\n            plugin.remove();\r\n            this._registeredPlugins.forEach((item, index) => {\r\n                if (item === plugin) this._registeredPlugins.splice(index, 1);\r\n            });\r\n        }\r\n    }\r\n\r\n    protected get window(): { addEventListener: (eventName: string, eventHandlerFunction: (e: any) => void) => void; } {\r\n        return window;\r\n    }\r\n\r\n    private startListeningForMessagesFromIFrame() {\r\n\r\n        if (this._registeredPlugins.length != 0) return;\r\n\r\n        this.window.addEventListener(\"message\", e => {\r\n            this.triggerActionInPlugin(e);\r\n        });\r\n    }\r\n\r\n    private triggerActionInPlugin(e: any) {\r\n        if (!e.data) return;\r\n\r\n        let dataJson = e.data as BildrPluginData;\r\n\r\n        let plugin = this._registeredPlugins.find(item => dataJson.pluginName && item.name == dataJson.pluginName);\r\n\r\n        if (plugin == undefined) return;\r\n\r\n        if (dataJson.data == undefined) dataJson.data = {};\r\n        dataJson.data.uMsgId = dataJson.uMsgId;\r\n\r\n        plugin.triggerAction(dataJson.command, dataJson.data);\r\n    }\r\n\r\n    public getVisiblePlugins() {\r\n        return this._registeredPlugins.filter(item => item.isVisible)\r\n    }\r\n\r\n    // STATIC FUNCTIONS\r\n    static getInstance(): BildrPluginManager {\r\n        if (this._instance == undefined) {\r\n            this._instance = new BildrPluginManager()\r\n        }\r\n        return this._instance\r\n    }\r\n    static remove(pluginName: string) {\r\n        this.getInstance().remove(pluginName)\r\n    }\r\n\r\n    static isRegistered(pluginName: string): boolean {\r\n        return this.getInstance().isRegistered(pluginName)\r\n    }\r\n\r\n    static register(plugin: BildrPluginRightSide) {\r\n        this.getInstance().register(plugin)\r\n    }\r\n\r\n    static getVisiblePlugins() {\r\n        return this.getInstance().getVisiblePlugins();\r\n    }\r\n\r\n    static showPlugin(pluginName: string) {\r\n        this.getInstance().showPlugin(pluginName)\r\n    }\r\n\r\n}\r\n\r\ntype BildrPluginData = {\r\n    pluginName: string,\r\n    command: string,\r\n    uMsgId: string,\r\n    data: any\r\n}\r\n\r\n","import { BildrPluginRightSide, BildrPluginAction } from \"./plugin/BildrPluginRightSide\";\r\nimport { BildrPluginManager } from './plugin/BildrPluginManager';\r\n\r\nexport class MarketplacePlugin extends BildrPluginRightSide {\r\n    private Version = \"2\";\r\n\r\n    constructor() {\r\n        super(\"marketplace\", \"https://marketplace.bildr.com/BE\")\r\n        this.addAction(\"hideMarketplacePlugin\", () => { this.hide(); return undefined });\r\n        this.addAction(\"getMarketPlaceVersion\", () => { return this.Version });\r\n\r\n        this.addAction(\"getProjectActionTypes\", () => { return BildrAPIHelper.getProjectActionTypes() });\r\n        this.addAction(\"getProjectFunctions\", () => { return BildrAPIHelper.getProjectFunctions(); });\r\n        this.addAction(\"getProjectPreviewId\", () => { return BildrAPIHelper.getProjectPreviewId(); });\r\n\r\n        this.addActionObject(new getActionTypeByMarketplaceIdAction());\r\n        this.addActionObject(new addActionTypeWithFunctionsAction(this.sendOutgoingMessage));\r\n        this.addActionObject(new updateActionTypeWithFunctionsAction(this.sendOutgoingMessage));\r\n\r\n        this.addActionObject(new imageUrlToBase64Action(this.sendOutgoingMessage));\r\n    }\r\n\r\n    protected override sendOutgoingMessage(msgId: string, result: any) {\r\n        // Maybe this can be simplified since result is always success and\r\n        // message contained the action name but never gets used I think.\r\n        // But that requires also changes in the Marketplace plugin Website in \r\n        // all places where data is received an processed.... not easy to find where.\r\n        var marketplaceResult = {\r\n            \"result\": \"succes\",\r\n            \"message\": \"\",  // was this needed anyway in the marketplace?\r\n            \"data\": result\r\n        }\r\n        super.sendOutgoingMessage(msgId, marketplaceResult)\r\n    }\r\n}\r\n\r\ntype sendOutgoingMessage = (msgId: string, result: any) => void;\r\n\r\nclass getActionTypeByMarketplaceIdAction implements BildrPluginAction {\r\n\r\n    get name(): string {\r\n        return \"getActionTypeByMarketplaceId\";\r\n    }\r\n\r\n    public execFunc(args: any) {\r\n        let projectActionTypes = BildrAPIHelper.getProjectActionTypes();\r\n\r\n        var returnVal = projectActionTypes.find((act: actionType): boolean => {\r\n            return (act.opts.marketplace?.actionTypeID == args.actionTypeId)\r\n        })\r\n        return returnVal;;\r\n    }\r\n}\r\n\r\nclass updateActionTypeWithFunctionsAction implements BildrPluginAction {\r\n\r\n    private _sendMessageFunc: sendOutgoingMessage;\r\n\r\n    // static addActionTypeWithFunctions(msgId: string);\r\n    constructor(sendMessageFunc: sendOutgoingMessage) {\r\n        this._sendMessageFunc = sendMessageFunc\r\n    }\r\n    get name(): string {\r\n        return \"updateActionTypeWithFunctions\";\r\n    }\r\n\r\n    execFunc(data: any) {\r\n\r\n        for (var index = 0; index < data.functions.length; index++) {\r\n            var functData = data.functions[index];\r\n            let stateData = {\r\n                \"last\": index + 1 == data.functions.length\r\n            }\r\n            var dataToSave = {\r\n                \"id\": functData.id,\r\n                \"opts\": functData.opts\r\n            }\r\n            BildrAPIHelper.saveFiltersetRecord(\"7\", dataToSave, stateData, (_returnData: any, stateData: { last: boolean; }) => {\r\n\r\n                // Is this the last function added to the project?\r\n                if (stateData.last) {\r\n\r\n                    BildrAPIHelper.saveFiltersetRecord(\"16\", data.actionTypeJson, null, (returnData: any) => {\r\n                        this._sendMessageFunc(data.msgId, returnData)\r\n                    });\r\n                }\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nclass addActionTypeWithFunctionsAction implements BildrPluginAction {\r\n    private _sendMessageFunc: sendOutgoingMessage;\r\n\r\n    // static addActionTypeWithFunctions(msgId: string);\r\n    constructor(sendMessageFunc: sendOutgoingMessage) {\r\n        this._sendMessageFunc = sendMessageFunc\r\n    }\r\n\r\n    get name(): string {\r\n        return \"addActionTypeWithFunctions\";\r\n    }\r\n\r\n    public execFunc(data: any) {\r\n        // * add some extra info to replace the original function Id by new function Id in \r\n        //   the actionType.functions array\r\n        // * data contains the json object data to store\r\n        var functionsArr = data.functions.map((funct: functon) => {\r\n            let returnData: convertFunction = {\r\n                \"originalId\": funct.id,\r\n                \"newId\": \"0\",\r\n                \"data\": {\r\n                    \"id\": 0,\r\n                    \"type\": funct.type,\r\n                    \"name\": funct.name,\r\n                    \"opts\": funct.opts,\r\n                    \"JsCode\": funct.JsCode,\r\n                }\r\n            }\r\n            return returnData;\r\n        });\r\n\r\n        // Add functions to the Bildr Project by putting them on the queue\r\n        // when the last function is added to the Bildr project \r\n        // replace all originalId by their newId in actionType.functions\r\n        // and save the actionType\r\n        for (var index = 0; index < functionsArr.length; index++) {\r\n            var funct = functionsArr[index];\r\n            let stateData = {\r\n                \"index\": index,\r\n                \"last\": index + 1 == functionsArr.length\r\n            }\r\n            BildrAPIHelper.saveFiltersetRecord(\"7\", funct.data, stateData, (returnData: { recs: { id: string; }[]; }, stateData: { index: number; last: boolean; }) => {\r\n                // remember the newly created function id\r\n                let index = stateData.index;\r\n                functionsArr[index].newId = returnData.recs[0].id;\r\n\r\n                // Is this the last function added to the project?\r\n                if (stateData.last) {\r\n                    // update ids of actionType.functions\r\n                    functionsArr.forEach((fnc: convertFunction) => {\r\n                        for (let i = 0; i < data.actionTypeJson.functions.length; i++) {\r\n                            if (data.actionTypeJson.functions[i].id == fnc.originalId) {\r\n                                data.actionTypeJson.functions[i].id = fnc.newId;\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    // add actionType\r\n                    var actionTypeJson = {\r\n                        \"id\": 0,\r\n                        \"name\": data.actionTypeJson.settings.displayName,\r\n                        \"opts\": data.actionTypeJson\r\n                    }\r\n\r\n                    BildrAPIHelper.saveFiltersetRecord(\"16\", actionTypeJson, null, (returnData: any) => {\r\n                        this._sendMessageFunc(data.msgId, returnData)\r\n                    });\r\n\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\nclass imageUrlToBase64Action implements BildrPluginAction {\r\n    private _sendMessageFunc: sendOutgoingMessage;\r\n\r\n    // static addActionTypeWithFunctions(msgId: string);\r\n    constructor(sendMessageFunc: sendOutgoingMessage) {\r\n        this._sendMessageFunc = sendMessageFunc\r\n    }\r\n\r\n    get name(): string {\r\n        return \"imageUrlToBase64\";\r\n    }\r\n    execFunc(data: any) {\r\n        this.imageUrlToBase64(data.iconUrl, (dataUrl: string) => {\r\n            this._sendMessageFunc(data.msgId, dataUrl);\r\n        })\r\n        return undefined;\r\n    }\r\n\r\n    private imageUrlToBase64(src: string, callback: Function): void {\r\n        var img = new Image();\r\n        img.crossOrigin = 'Anonymous';\r\n        img.onload = function () {\r\n\r\n            const MAX_WIDTH = 30;\r\n            const MAX_HEIGHT = 30;\r\n            let width = img.naturalHeight;\r\n            let height = img.naturalHeight;\r\n\r\n            // Change the resizing logic\r\n            if (width > height) {\r\n                if (width > MAX_WIDTH) {\r\n                    height = height * (MAX_WIDTH / width);\r\n                    width = MAX_WIDTH;\r\n                }\r\n            } else {\r\n                if (height > MAX_HEIGHT) {\r\n                    width = width * (MAX_HEIGHT / height);\r\n                    height = MAX_HEIGHT;\r\n                }\r\n            }\r\n\r\n            // create canvas to draw on\r\n            let canvas = document.createElement('CANVAS') as HTMLCanvasElement;\r\n            let ctx = canvas.getContext('2d');\r\n\r\n            // set size and draw\r\n            canvas.height = height;\r\n            canvas.width = width;\r\n\r\n            //ctx.mozImageSmoothingEnabled = false;\r\n            //ctx.webkitImageSmoothingEnabled = false;\r\n            //ctx.msImageSmoothingEnabled = false;\r\n            //ctx.imageSmoothingEnabled = false;\r\n\r\n            ctx!.drawImage(img, 0, 0, width, height);\r\n\r\n            // Encode the resized image to bas64 png\r\n            let dataURL = canvas.toDataURL(\"image/png\");\r\n\r\n            // return result\r\n            callback(dataURL);\r\n        };\r\n        img.src = src;\r\n        if (img.complete || img.complete === undefined) {\r\n            img.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n            img.src = src;\r\n        }\r\n    }\r\n\r\n}\r\n\r\ntype convertFunction = {\r\n    \"originalId\": string | number,\r\n    \"newId\": string,\r\n    \"data\": functon\r\n}\r\n\r\nclass BildrAPIHelper {\r\n\r\n    static saveFiltersetRecord(filtersetID: string, dataToSave: any, stateData: any, afterOnSucces: Function) {\r\n\r\n        // create custom action to execute RecordSave\r\n        var act = new Action(0, 0, 0, \"BildrAPIHelper adding filterset: \" + dataToSave.filtersetID, '', '');\r\n        act.exec = function (qa: any) {\r\n\r\n            var jsonData = parseStrAsJson(dataToSave)\r\n\r\n            var onSucces = function (data: any, message: string) {\r\n                data.recs.forEach((rec: any) => {\r\n                    if (rec.ERROR && rec.ERROR == true) {\r\n                        console.log(\"ERROR IN: BildrAPIHelper.saveFiltersetRecord.onSucces\");\r\n                        console.log(\"message: \" + JSON.stringify(message));\r\n                        console.log(data);\r\n                    }\r\n                })\r\n                QueueExecNextActions(qa);\r\n                if (afterOnSucces) {\r\n                    afterOnSucces(data, stateData);\r\n                }\r\n            };\r\n            var onError = function (data: any, message: string) {\r\n                console.log(\"ERROR IN: BildrAPIHelper.saveFiltersetRecord.onError\");\r\n                console.log(\"message: \" + JSON.stringify(message));\r\n                console.log(data);\r\n                QueueExecNextActions(qa);\r\n            };\r\n\r\n            RecordSave(jsonData, filtersetID, qa, onSucces, onError, null, null);\r\n        }\r\n\r\n        // add action to the Queue\r\n        BildrAPIHelper.addToActionQueue2(act);\r\n    }\r\n\r\n    static addToActionQueue2(action: Action) {\r\n        var _brObj = brwFormRoot.brObj;\r\n        var _brForm = brwFormRoot;\r\n\r\n        var qaBildrCache = null;\r\n\r\n        var qa2 = new (QueueAction as any)(action, 1, null, _brObj, {\r\n            \"brwObj\": _brObj,\r\n            \"brwForm\": _brForm,\r\n            \"event\": null\r\n        }, null, null, qaBildrCache, 1);\r\n    }\r\n\r\n    static getProjectActionTypes() {\r\n        let cache = BildrDBCacheGet(true);\r\n        let actionTypes = cache.actionsTypes.recs.filter((at: actionType) => {\r\n            // Only when \r\n            // Not Archived\r\n            // Not a core action type\r\n            return (at.opts.archived == false && (!at.opts.coreType || at.opts.coreType * 1 == 0));\r\n        });\r\n\r\n        // should there be some mapping done here to prevent problems in the future (see getProjectFunctions)\r\n\r\n        return actionTypes;\r\n\r\n    }\r\n    static getProjectFunctions() {\r\n        let cache = BildrDBCacheGet(true);\r\n\r\n        // Only when \r\n        // Not Deleted\r\n        // ** if archived needs filtering then filter on: opts.archived (1 = archived)\r\n        // ** seems to only be their when archive (no = 0)\r\n        let functions = cache.functions.recs.filter((funct: functon) => {\r\n            return (!funct.deleted || funct.deleted * 1 == 0)\r\n        })\r\n\r\n        // Need to map because the javascript functions in a function object can't be\r\n        // deep copied/cloned and crash the PostMessage to the iFrame.\r\n        functions = functions.map((funct: functon) => {\r\n            let returnData = {\r\n                \"id\": funct.id,\r\n                \"JsCode\": funct.JsCode,\r\n                \"modifiedDate\": funct.modifiedDate,\r\n                \"name\": funct.name,\r\n                \"opts\": funct.opts,\r\n                \"type\": funct.type\r\n            }\r\n            return returnData;\r\n        });\r\n        return functions;\r\n    }\r\n\r\n    static getProjectPreviewId() {\r\n        let id = location.href.split(\"=\");\r\n        return id[1];\r\n    }\r\n\r\n}\r\n\r\nclass MarketplaceMenuBarButton {\r\n    static marketplaceMenuItemDivId = \"bildrMarketplaceMenuItem\";\r\n    static topMenuBarDivCss = \"css_V9oRPFpIjEqGDrWGUv9yWg\";\r\n\r\n    static isTopBarAvailable() {\r\n        return document.querySelector(`.${MarketplaceMenuBarButton.topMenuBarDivCss}`);\r\n    }\r\n\r\n    static create() {\r\n        if (!document.getElementById(MarketplaceMenuBarButton.marketplaceMenuItemDivId)) {\r\n            // init page for smooth sliding in and not seeing the page load\r\n            let plugin = new MarketplacePlugin();\r\n            BildrPluginManager.register(plugin)\r\n\r\n            // Make some space in the menu bar\r\n            var topMenuBar = document.querySelector(`.${MarketplaceMenuBarButton.topMenuBarDivCss}`) as HTMLDivElement;\r\n            topMenuBar.style.width = \"520px\";\r\n\r\n            // CREATE menu bar item\r\n            var elem = document.createElement(\"div\");\r\n            elem.id = MarketplaceMenuBarButton.marketplaceMenuItemDivId;\r\n            elem.className = \"css_BRQAelSiDkOyetXlS0VDMQ\";\r\n            elem.innerHTML = \"<img src='https://documents-weu.bildr.com/r9f576480f5ba4b118cec7ce8e6c345e3/doc/Bildr marketplace logo WB color.ynHqabhunkG6oesIc3Xzvg.png' class='css_0EWldTyzqU60XwJWKjRXog' style='filter:none;'><p class='css_BzJ7ABkWfkeHKsQbcZKVbA css_ixReGSYmjkKU0b6bxZNTHw'>market</p>\";\r\n            // add to top menu bar\r\n            topMenuBar.appendChild(elem);\r\n\r\n            // Handle click on button, inside the plugin or outside the plugin (auto hide)\r\n            // Mind the config param capture: true on the addEventListener\r\n            document.body.addEventListener('click', e => {\r\n\r\n                let marketplacePage = new MarketplacePlugin()\r\n                var target = (e && e.target);\r\n                // assume the click is outside the plugin / div\r\n                let action = \"hide\";\r\n\r\n                while ((target as HTMLElement).parentNode) {\r\n\r\n                    // Ignore click inside the plugin / div\r\n                    if (plugin.isSameDivElem(target as HTMLDivElement)) {\r\n                        action = \"\";\r\n                        break;\r\n                    }\r\n                    // Handles click on Marketplace button (and image and tekst)\r\n                    if (target && (target as HTMLElement).id == MarketplaceMenuBarButton.marketplaceMenuItemDivId) {\r\n                        action = \"toggle\";\r\n                        break;\r\n                    }\r\n                    target = (target as HTMLElement).parentNode;\r\n                }\r\n\r\n                if (action == \"hide\") { marketplacePage.hide(); }\r\n                if (action == \"toggle\") { marketplacePage.toggleVisibility(); }\r\n            }, { capture: true })\r\n\r\n        }\r\n    }\r\n}\r\n\r\nvar onStudioLoadObservers = [];\r\n// set up marketplace button as soon as top bar is available\r\nonStudioLoadObservers.push(new MutationObserver(function (_mutations, me) {\r\n    // `me` is the MutationObserver instance\r\n\r\n    if (MarketplaceMenuBarButton.isTopBarAvailable()) {\r\n        // stop observing\r\n        me.disconnect();\r\n\r\n        MarketplaceMenuBarButton.create();\r\n    }\r\n}))\r\n\r\n// prevent running this script when not in Bildr Studio\r\nif (location.href.indexOf(\"https://www.bildr.com/studio?projectName=\") != -1) {\r\n    // start observing\r\n\r\n    onStudioLoadObservers.forEach(observer => {\r\n        observer.observe(document, {\r\n            childList: true,\r\n            subtree: true\r\n        });\r\n    });\r\n}"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","SimplePluginAction","constructor","actionName","execFunc","this","name","_execFunc","args","BildrPluginManager","_registeredPlugins","register","plugin","undefined","trim","length","Error","isRegistered","startListeningForMessagesFromIFrame","push","renderPage","pluginName","find","item","showPlugin","show","remove","forEach","index","splice","window","addEventListener","e","triggerActionInPlugin","data","dataJson","uMsgId","triggerAction","command","getVisiblePlugins","filter","isVisible","static","_instance","getInstance","MarketplacePlugin","pageUrl","_actions","_name","_pageUrl","_divId","Math","random","toString","slice","_frameId","divElem","_divElem","isSameDivElem","sendOutgoingMessage","msgId","result","document","getElementById","contentWindow","postMessage","actionData","action","hide","style","right","width","toggleVisibility","elem","createElement","id","cssText","innerHTML","body","appendChild","_e","removeChild","addActionObject","addAction","execFnc","super","Version","BildrAPIHelper","getProjectActionTypes","getProjectFunctions","getProjectPreviewId","getActionTypeByMarketplaceIdAction","addActionTypeWithFunctionsAction","updateActionTypeWithFunctionsAction","imageUrlToBase64Action","marketplaceResult","act","opts","marketplace","actionTypeID","actionTypeId","sendMessageFunc","_sendMessageFunc","functions","functData","stateData","dataToSave","saveFiltersetRecord","_returnData","last","actionTypeJson","returnData","functionsArr","map","funct","type","JsCode","newId","recs","fnc","i","originalId","settings","displayName","imageUrlToBase64","iconUrl","dataUrl","src","callback","img","Image","crossOrigin","onload","naturalHeight","height","canvas","ctx","getContext","drawImage","dataURL","toDataURL","complete","filtersetID","afterOnSucces","Action","exec","qa","jsonData","parseStrAsJson","RecordSave","message","rec","ERROR","console","log","JSON","stringify","QueueExecNextActions","addToActionQueue2","_brObj","brwFormRoot","brObj","_brForm","QueueAction","BildrDBCacheGet","actionsTypes","at","archived","coreType","deleted","modifiedDate","location","href","split","MarketplaceMenuBarButton","querySelector","topMenuBarDivCss","marketplaceMenuItemDivId","topMenuBar","className","marketplacePage","target","parentNode","capture","onStudioLoadObservers","MutationObserver","_mutations","me","isTopBarAvailable","disconnect","create","indexOf","observer","observe","childList","subtree"],"sourceRoot":""}