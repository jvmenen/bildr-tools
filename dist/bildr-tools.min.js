(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ActionTypes:()=>h,Actions:()=>d,ActionsToShowEnum:()=>g,Debug:()=>u,Flows:()=>f});const o=(e,t)=>e.reduce(((e,o)=>{const n=t(o);return e[n]||(e[n]=[]),e[n].push(o),e}),{}),n=e=>e.sort(((e,t)=>(""+e.name).localeCompare(t.name)));class i{constructor(e,t,o){this.name=e,this.exec=t,this.nullDefault=o,this.clear()}clear(){this.value}getValue(){return null==this.value&&(this.value=this.exec()),this.value?this.value:this.nullDefault}}class s{constructor(){this.cache=[]}register(e,t,o){this.cache.push(new i(e,t,o))}getValue(e){let t=this.cache.find((t=>t.name==e));if(t)return t.getValue();throw new Error("variableName is not defined")}clear(){this.cache.forEach((e=>e.clear()))}}class a{constructor(...e){1===e.length?this.bildrCache=BildrDBCacheGet(e[0],"","",null):2===e.length?this.bildrCache=BildrDBCacheGet(!1,e[0],e[1],null):this.bildrCache=BildrDBCacheGet(!0,"","",null),this.cache=new s,this.cache.register("actionsGroupedByFormID",(()=>o(this.actions,(e=>e.formID))),o([],(()=>""))),this.cache.register("actions",(()=>this.bildrCache.actions.recs.map((e=>new c(e,this)))),Array()),this.cache.register("flows",(()=>this.actions.filter((e=>"68"==e.type)).map((e=>new r(e,this)))),Array()),this.cache.register("elements",(()=>this.bildrCache.elements.recs),Array()),this.cache.register("pages",(()=>this.bildrCache.forms.recs.map((e=>new l(e,this)))),Array()),this.cache.register("actionTypes",(()=>this.bildrCache.actionsTypes.recs),Array()),this.cache.register("activePages",(()=>this.pages.filter((e=>0==e.deleted&&1!=e.opts.archived))),Array()),this.cache.register("activeFlows",(()=>this.flows.filter((e=>0==e.deleted))),Array()),this.cache.register("deletedFlows",(()=>this.flows.filter((e=>0!=e.deleted))),Array()),this.cache.register("activeFlowsGroupedByFormID",(()=>o(this.activeFlows,(e=>e.formID))),o([],(()=>""))),this.cache.register("activeElements",(()=>this.elements.filter((e=>0==e.deleted))),Array())}get actions(){return this.cache.getValue("actions")}get flows(){return this.cache.getValue("flows")}get elements(){return this.cache.getValue("elements")}get pages(){return this.cache.getValue("pages")}get actionTypes(){return this.cache.getValue("actionTypes")}get activePages(){return this.cache.getValue("activePages")}get activeFlows(){return this.cache.getValue("activeFlows")}get deletedFlows(){return this.cache.getValue("deletedFlows")}get activeFlowsGroupedByFormID(){return this.cache.getValue("activeFlowsGroupedByFormID")}get actionsGroupedByFormID(){return this.cache.getValue("actionsGroupedByFormID")}get activeElements(){return this.cache.getValue("activeElements")}}a.createInstance=()=>new a(!0);class l{constructor(e,t){this.opts=e.opts,this.objsTree=e.objsTree,this.actions=e.actions,this.deleted=e.deleted,this.name=e.name,this.id=e.id,this.bildrCache=t}get ActiveFlows(){return this.bildrCache.activeFlowsGroupedByFormID[this.id.toString()]||Array()}get ActiveElements(){let e=Array();return function t(o){null!=o&&o.forEach((o=>{t(o.items),e.push(o)}))}(this.objsTree),e}}class c{constructor(e,t){this.opts=e.opts,this.formID=e.formID,this.type=e.type,this.deleted=e.deleted,this.name=e.name,this.id=e.id,this.bildrCache=t}get Page(){return this.page||(this.page=this.bildrCache.pages.find((e=>e.id==this.formID))),this.page}get Arguments(){return this.opts.arguments}}class r extends c{constructor(e,t){super(e,t)}get Actions(){let e=this.opts.arguments.find((e=>"actionsArray"==e.name)),t=Array();if(!e)return t;let o=e;return o.value?(o.value.forEach((e=>{let o=this.bildrCache.actionsGroupedByFormID[this.formID].find((t=>t.id==e.id));o&&t.push(o)})),t):t}}class d{static findInPath(e,t=!1){let o=a.createInstance();e=e.trim();let i=t=>t.includes(e);t&&(i=t=>t==e),"*"==e&&(i=e=>!0);let s=e=>console.log(e);s(`Path ${e} with exact match = ${t} is called by:`),s(""),o.activePages.forEach((o=>{let a=!1;n(o.ActiveFlows).forEach((n=>{n.Actions.forEach((l=>{l.Arguments.forEach((c=>{if("variable"!=c.argumentType&&"element"!=c.argumentType)return;let r=c;r.path&&i(r.path)&&(a||(a=!0,s("Page : "+o.name)),s(`  Flow : ${n.name} (id: ${n.id})`),s("    Action : "+l.name),"*"!=e&&0!=t||s("      Path : "+r.path))}))}))}))})),s(""),s("THAT'S IT!")}static findVariable(e,t=!0,o=!0,i=!0){let s=a.createInstance();e=e.trim();let l=t=>t.includes(e);i&&(l=t=>t==e),"*"==e&&(l=e=>!0);let c=e=>console.log(e);function r(t,o,n,i,s,a){if("variable"==t.argumentType){let r=t;r.variableName&&l(r.variableName)&&(n||(n=!0,c("Page : "+i.name)),s||(s=!0,c(`  Flow : ${a.name} (id: ${a.id})`)),c("    Used in Action : "+o.name),"*"==e&&c("      Variable : "+r.variableName))}return{pageNameLogged:n,flowNameLogged:s}}c(`Variable ${e} with exact match = ${i} is used here:`),c(""),s.activePages.forEach((i=>{let s=!1;n(i.ActiveFlows).forEach((n=>{let a=!1;n.Actions.forEach((d=>{d.Arguments.forEach((h=>{var g;if(t&&"static.text"==h.argumentType&&1==h.thisIsAVariableName){let t=h;t.value&&l(t.value)&&(s||(s=!0,c("Page : "+i.name)),a||(a=!0,c(`  Flow : ${n.name} (id: ${n.id})`)),c("    Set in Action : "+d.name),"*"==e&&c("      Variable : "+t.value))}o&&({pageNameLogged:s,flowNameLogged:a}=r(h,d,s,i,a,n)),o&&"filterset"==h.argumentType&&(null===(g=h.filters)||void 0===g||g.forEach((e=>{e.fieldsToFilterArray.forEach((e=>{e.valueToFilterWith.forEach((e=>{({pageNameLogged:s,flowNameLogged:a}=r(e,d,s,i,a,n))}))}))})))}))}))}))})),c(""),c("THAT'S IT!")}}class h{static findUsage(e){let t=a.createInstance();function o(e){console.log(e)}let i=t.actionTypes.find((t=>t.id==e));i?(o(`Action Type "${i.name}" is called by:`),o(""),t.activePages.forEach((t=>{let i=!1;n(t.ActiveFlows).forEach((n=>{n.Actions.forEach((s=>{s.type==e&&(i||(i=!0,o("Page : "+t.name)),o(`  Flow : ${n.name} (id: ${n.id})`),o("    Action : "+s.name))}))}))})),o(""),o("THAT'S IT!")):o(`Couldn't find Action Type ${e} in project!`)}}var g;!function(e){e[e.Flows=1]="Flows",e[e.Actions=2]="Actions",e[e.BildrActions=4]="BildrActions",e[e.MouseActions=8]="MouseActions"}(g||(g={}));class u{static ShowAllVariables(){!function e(t){t&&t.form&&t.form.name&&console.log(`Variables of Page: ${t.form.name}`);let o=t._vars;o&&(console.log(o),t.cBrwForms&&t.cBrwForms.forEach((t=>{e(t)})))}(brwFormRoot)}static Start(e){window.orgQAFunc||(window.orgQAFunc=QueueAction),window.QueueAction=function(t,o,n,i,s,l,c,r,d){let h=(u.ActionsToShow&g.Flows)===g.Flows,f=(u.ActionsToShow&g.Actions)===g.Actions,m=(u.ActionsToShow&g.BildrActions)===g.BildrActions,p=(u.ActionsToShow&g.MouseActions)===g.MouseActions;if(t){let o="V3gKt5FZRECIDMudjBbi3g"==t.id||"AGTUwIokUuQgXEgNW6mnA"==t.id||"CAGTUwIokUuQgXEgNW6mnA"==t.id,n="68"==t.type;if(o&&p||n&&h||!o&&!n&&f){let o;if(t.id&&!m&&(o=a.createInstance().actions.find((e=>e.id==t.id))),null!=o||m){let o=n?"Flow  ":"Action",i=n?"":"  --";console.log(`${o}: ${t.id} ${i}  "${t.name}"`),(u._StepMode||e&&t.id==e)&&(u._StepMode=!0)}}}window.orgQAFunc.call(this,t,o,n,i,s,l,c,r,d)},window.QueueAction.prototype=window.orgQAFunc.prototype,window.QueueAction.prototype.constructor=QueueAction}static Stop(){window.orgQAFunc&&(window.QueueAction=window.orgQAFunc)}static StepModeOff(){u._StepMode=!1}}u._StepMode=!1,u.ActionsToShow=g.Flows;class f{static findUnusedFlows(e=!0){let t=a.createInstance();const o=n(t.activePages);console.log(`Checking ${t.activeFlows.length} flows.`),console.log("You'll see 'That's it!' when checking is finished."),console.log(""),e?console.log("Looking for Unused flows (skipping unused 'Auto Save')"):console.log("Looking for All unused flows"),console.log(""),o.forEach((t=>{let o=!1;n(t.ActiveFlows).forEach((n=>{e&&n.name.includes("Auto Save")||0==f.findUsageOfFlow(n.id,!1)&&(o||(o=!0,console.log("Page : "+t.name)),console.log("  Flow : "+n.name))}))})),console.log(""),console.log("THAT'S IT!")}static findUsageOfFlow(e,t=!0){let o=a.createInstance();const i=e.toString();let s=!1;function l(e){t&&console.log(e)}let c=o.activeFlows.find((t=>t.id==e));return c?(c.Page?l(`Flow "${c.name}" on page "${c.Page.name}" is called by:`):l(`Couldn't find page for flowID ${e} in project!`),l(""),o.activePages.forEach((e=>{var t,o,a,c,r,d;let h=!1;n(e.ActiveFlows).forEach((t=>{t.Actions.forEach((o=>{o.id.toString().endsWith(i)?(s=!0,h||(h=!0,l("Page : "+e.name)),l(`  Flow : ${t.name} (id: ${t.id})`),l("    as nested flow")):o.Arguments.forEach((n=>{var a;if("static.actions"==n.argumentType){let c=n;"static.actions"==c.type&&(null===(a=c.value)||void 0===a?void 0:a.endsWith(i))&&(s=!0,h||(h=!0,l("Page : "+e.name)),l(`  Flow : ${t.name} (id: ${t.id})`),l("    Action : "+o.name))}}))}))})),n(e.ActiveElements).forEach((t=>{t.opts.events.filter((e=>e.actID&&e.actID.toString().endsWith(i))).forEach((o=>{s=!0,h||(h=!0,l("Page : "+e.name)),l("  Element : "+t.name),l("    Event : "+o.code)}))}));let g=[];if((null===(t=e.opts.autoSaveActionID)||void 0===t?void 0:t.toString().endsWith(i))&&g.push("Auto-Save Flow"),(null===(o=e.opts.onLoadAct)||void 0===o?void 0:o.toString().endsWith(i))&&g.push("Page Load Flow"),(null===(a=e.opts.notConnectedActID)||void 0===a?void 0:a.toString().endsWith(i))&&g.push("Flow to run when connection is lost"),(null===(c=e.opts.reConnectedActID)||void 0===c?void 0:c.toString().endsWith(i))&&g.push("Flow to run when connection is re-established"),(null===(r=e.opts.notAuthenticatedActID)||void 0===r?void 0:r.toString().endsWith(i))&&g.push("Flow to run when authentication is lost"),(null===(d=e.opts.newRevisionActID)||void 0===d?void 0:d.toString().endsWith(i))&&g.push("Flow to Run When Revision is Out of Date"),g.length>0&&(s=!0,l("Page : "+e.name),l("  Element : Page Body"),g.forEach((e=>{l("    Event : "+e)}))),e.opts.resonanceDataListeners){let t=e.opts.resonanceDataListeners.filter((e=>e.actID&&e.actID.toString().endsWith(i)));t.length>0&&(s=!0,l("Page : "+e.name),l("  Element : Page Body"),l(`    Used by ${t.length} Data Listener(s)`))}})),l(""),l("THAT'S IT!"),s):(l(`Couldn't find flowID ${e} in project!`),!1)}static findUsageOfDeletedFlows(){let e=a.createInstance();function t(t){return null!=e.deletedFlows.find((e=>e.id.toString().endsWith(t.toString())))}e.activeFlows.forEach((o=>{var n;if(o.opts&&o.opts.arguments){let i=o.opts.arguments.find((e=>"actionsArray"==e.name));i&&(null===(n=i.value)||void 0===n||n.forEach((n=>{if(n.id&&t(n.id)){let t=e.pages.find((e=>e.id==o.formID));if(t){console.log(`Page : ${t.name}`),console.log(`  Flow : ${o.name} (id: ${o.id})`);const i=e.deletedFlows.find((e=>e&&e.id.toString().endsWith(n.id.toString())));console.log(i)}}else{let i=e.actions.find((e=>e.id==n.id));if(i&&i.opts&&i.opts.arguments&&i.opts.arguments.find((e=>"static.actions"==e.argumentType&&e.value&&t(e.value)))){let t=e.pages.find((e=>e.id==o.formID));t&&(console.log(`Page : ${t.name}`),console.log(`  Flow : ${o.name} (id: ${o.id})`),console.log(`    Action : ${i.name}`))}}})))}})),e.activePages.forEach((o=>{var i=Array();!function e(t){null!=t&&t.forEach((t=>{e(t.items),i.push(t)}))}(o.objsTree),n(i).forEach((o=>{o.opts&&o.opts.events&&o.opts.events.filter((e=>e.actID&&t(e.actID))).forEach((t=>{let n=e.pages.find((e=>e.id==o.formID));n&&(console.log("Page : "+n.name),console.log("  Element : "+o.name),console.log("    Event : "+t.code))}))}));let s=[];if(o.opts&&(o.opts.autoSaveActionID&&t(o.opts.autoSaveActionID)&&s.push("Auto-Save Flow"),o.opts.onLoadAct&&t(o.opts.onLoadAct)&&s.push("Page Load Flow"),o.opts.notConnectedActID&&t(o.opts.notConnectedActID)&&s.push("Flow to run when connection is lost"),o.opts.reConnectedActID&&t(o.opts.reConnectedActID)&&s.push("Flow to run when connection is re-established"),o.opts.notAuthenticatedActID&&t(o.opts.notAuthenticatedActID)&&s.push("Flow to run when authentication is lost"),o.opts.newRevisionActID&&t(o.opts.newRevisionActID)&&s.push("Flow to Run When Revision is Out of Date"),s.length>0&&(console.log("Page : "+o.name),console.log("  Element : Page Body"),s.forEach((e=>{console.log("    Event : "+e)}))),o.opts.resonanceDataListeners)){let e=o.opts.resonanceDataListeners.filter((e=>e.actID&&t(e.actID)));e.length>0&&(console.log("Page : "+o.name),console.log("  Element : Page Body"),console.log(`    Used by ${e.length} Data Listener(s)`))}})),console.log(""),console.log("THAT'S IT!")}static getFlowWithActions(e){var t;let o=a.createInstance(),n=o.activeFlows.find((t=>t.id&&t.id.toString()==e));if(null!=n){if(console.log("Flow found:"),console.log(n),console.log("Actions:"),n.opts&&n.opts.arguments){let e=n.opts.arguments.find((e=>"actionsArray"==e.name));e&&(null===(t=e.value)||void 0===t||t.forEach((e=>{let t=o.actions.find((t=>t.id.toString()==e.id.toString()));t&&console.log(t)})))}}else console.log("flow not found")}}window.BildrTools=t})();