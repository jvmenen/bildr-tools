/* Copyright 2022, Jeroen van Menen. bildr-tools 0.4.3 (Tue, 19 Jul 2022 15:44:00 GMT) */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Bildr=t():(e.Bildr=e.Bildr||{},e.Bildr.tools=t())}(self,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var i in o)e.o(o,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:o[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ActionTypes:()=>g,Actions:()=>d,ActionsToShowEnum:()=>u,Debug:()=>f,Flows:()=>m});const o=(e,t)=>e.reduce(((e,o)=>{const i=t(o);return e[i]||(e[i]=[]),e[i].push(o),e}),{}),i=e=>e.sort(((e,t)=>(""+e.name).localeCompare(t.name))),n=(e,t=!0)=>(t&&console.log(e),!1);class s{constructor(e,t,o){this.name=e,this.exec=t,this.nullDefault=o,this.clear()}clear(){this.value}getValue(){return null==this.value&&(this.value=this.exec()),this.value?this.value:this.nullDefault}}class a{constructor(){this.cache=[]}register(e,t,o){if(this.cache.find((t=>t.name==e)))throw new Error(`VariableName '${e}' already registered.`);this.cache.push(new s(e,t,o))}getValue(e){let t=this.cache.find((t=>t.name==e));if(t)return t.getValue();throw new Error(`VariableName '${e}' is not registered.`)}clear(){this.cache.forEach((e=>e.clear()))}}class c{constructor(...e){1===e.length?this.bildrCache=c.bildrDBCacheGet(e[0],"","",null):2===e.length?this.bildrCache=c.bildrDBCacheGet(!1,e[0],e[1],null):this.bildrCache=c.bildrDBCacheGet(!0,"","",null),this.cache=new a,this.cache.register("actionsGroupedByFormID",(()=>o(this.actions,(e=>e.formID))),o([],(()=>""))),this.cache.register("actions",(()=>this.bildrCache.actions.recs.map((e=>new r(e,this)))),Array()),this.cache.register("flows",(()=>this.actions.filter((e=>"68"==e.type)).map((e=>new h(e,this)))),Array()),this.cache.register("elements",(()=>this.bildrCache.elements.recs),Array()),this.cache.register("pages",(()=>this.bildrCache.forms.recs.map((e=>new l(e,this)))),Array()),this.cache.register("actionTypes",(()=>this.bildrCache.actionsTypes.recs),Array()),this.cache.register("activePages",(()=>this.pages.filter((e=>0==e.deleted&&1!=e.opts.archived))),Array()),this.cache.register("activeFlows",(()=>this.flows.filter((e=>0==e.deleted))),Array()),this.cache.register("deletedFlows",(()=>this.flows.filter((e=>0!=e.deleted))),Array()),this.cache.register("activeFlowsGroupedByFormID",(()=>o(this.activeFlows,(e=>e.formID))),o([],(()=>""))),this.cache.register("activeElements",(()=>this.elements.filter((e=>0==e.deleted))),Array())}get actions(){return this.cache.getValue("actions")}get flows(){return this.cache.getValue("flows")}get elements(){return this.cache.getValue("elements")}get pages(){return this.cache.getValue("pages")}get actionTypes(){return this.cache.getValue("actionTypes")}get activePages(){return this.cache.getValue("activePages")}get activeFlows(){return this.cache.getValue("activeFlows")}get deletedFlows(){return this.cache.getValue("deletedFlows")}get activeFlowsGroupedByFormID(){return this.cache.getValue("activeFlowsGroupedByFormID")}get actionsGroupedByFormID(){return this.cache.getValue("actionsGroupedByFormID")}get activeElements(){return this.cache.getValue("activeElements")}}c.createInstance=()=>new c(!0),c.bildrDBCacheGet=(...e)=>BildrDBCacheGet(e[0],e[1],e[2],e[3]);class l{constructor(e,t){this.opts=e.opts,this.objsTree=e.objsTree,this.actions=e.actions,this.deleted=e.deleted,this.name=e.name,this.id=e.id,this.bildrCache=t}get ActiveFlows(){let e=this.bildrCache.activeFlowsGroupedByFormID[this.id.toString()];return e||Array()}get ActiveElements(){let e=Array();return function t(o){null!=o&&o.forEach((o=>{t(o.items),e.push(o)}))}(this.objsTree),e}}class r{constructor(e,t){this.opts=e.opts,this.formID=e.formID,this.type=e.type,this.deleted=e.deleted,this.name=e.name,this.id=e.id,this.bildrCache=t}get Page(){return this.page||(this.page=this.bildrCache.pages.find((e=>e.id==this.formID))),this.page}get Arguments(){return this.opts.arguments}}class h extends r{constructor(e,t){super(e,t)}get Actions(){let e=this.opts.arguments.find((e=>"actionsArray"==e.name)),t=Array();if(!e)return t;let o=e;return o.value?(o.value.forEach((e=>{let o=this.bildrCache.actionsGroupedByFormID[this.formID].find((t=>t.id==e.id));o&&t.push(o)})),t):t}}class d{static findInPath(e,t=!1){let o=c.createInstance();e=e.trim();let s=t=>t.includes(e);t&&(s=t=>t==e),"*"==e&&(s=e=>e.length>0),n(`Path ${e} with exact match = ${t} is called by:`),n(""),o.activePages.forEach((o=>{let a=!0;i(o.ActiveFlows).forEach((i=>{let c=!0;i.Actions.forEach((l=>{l.Arguments.forEach((r=>{if(h(r),"filterset"==r.argumentType){r.filters?.forEach((e=>{e.fieldsToFilterArray.forEach((e=>{e.valueToFilterWith.forEach((e=>{h(e)}))}))}))}function h(r){if("variable"==r.argumentType){let e=r.value;if(!e||e.length<5)return;let h=e.indexOf(".",5);if(h<0)return;e=e.slice(h+1),s(e)&&(a=n("Page : "+o.name,a),c=n(`  Flow : ${i.name} (id: ${i.id})`,c),n("    Action : "+l.name),"*"!=e&&0!=t||n("      Path : "+e))}if("element"==r.argumentType){let h=r;h.path&&s(h.path)&&(a=n("Page : "+o.name,a),c=n(`  Flow : ${i.name} (id: ${i.id})`,c),n("    Action : "+l.name),"*"!=e&&0!=t||n("      Path : "+h.path))}}}))}))}))})),n(""),n("THAT'S IT!")}static findVariable(e,t=!0,o=!0,n=!0){let s=c.createInstance();e=e.trim();let a=t=>t.includes(e);n&&(a=t=>t==e),"*"==e&&(a=e=>!0);let l=(e,t=!0)=>(t&&console.log(e),!0);function r(t,o,i,n,s,c){if("variable"==t.argumentType){let r=t;r.variableName&&a(r.variableName)&&(i=l("Page : "+n.name,i),s=l(`  Flow : ${c.name} (id: ${c.id})`,s),l("    Used in Action : "+o.name),"*"==e&&l("      Variable : "+r.variableName))}return{pageNameLogged:i,flowNameLogged:s}}l(`Variable ${e} with exact match = ${n} is used here:`),l(""),s.activePages.forEach((n=>{let s=!0;i(n.ActiveFlows).forEach((i=>{let c=!0;i.Actions.forEach((h=>{h.Arguments.forEach((d=>{if(t&&"static.text"==d.argumentType&&1==d.thisIsAVariableName){let t=d;t.value&&a(t.value)&&(s=l("Page : "+n.name,s),c=l(`  Flow : ${i.name} (id: ${i.id})`,c),l("    Set in Action : "+h.name),"*"==e&&l("      Variable : "+t.value))}if(o&&({pageNameLogged:s,flowNameLogged:c}=r(d,h,s,n,c,i)),o&&"filterset"==d.argumentType){d.filters?.forEach((e=>{e.fieldsToFilterArray.forEach((e=>{e.valueToFilterWith.forEach((e=>{({pageNameLogged:s,flowNameLogged:c}=r(e,h,s,n,c,i))}))}))}))}}))}))}))})),l(""),l("THAT'S IT!")}}class g{static findUsage(e){let t=c.createInstance(),o=t.actionTypes.find((t=>t.id==e));o?(n(`Action Type "${o.name}" is called by:`),n(""),t.activePages.forEach((t=>{let o=!0;i(t.ActiveFlows).forEach((i=>{i.Actions.forEach((s=>{let a=!0;s.type==e&&(o=n("Page : "+t.name,o),a=n(`  Flow : ${i.name} (id: ${i.id})`,a),n("    Action : "+s.name))}))}))})),n(""),n("THAT'S IT!")):n(`Couldn't find Action Type ${e} in project!`)}}var u;!function(e){e[e.Flows=1]="Flows",e[e.Actions=2]="Actions",e[e.BildrActions=4]="BildrActions",e[e.MouseActions=8]="MouseActions"}(u||(u={}));class f{static ShowAllVariables(){!function e(t){t&&t.form&&t.form.name&&console.log(`Variables of Page: ${t.form.name}`);let o=t._vars;o&&(console.log(o),t.cBrwForms&&t.cBrwForms.forEach((t=>{e(t)})))}(brwFormRoot)}static Start(e){window.orgQAFunc||(window.orgQAFunc=QueueAction),window.QueueAction=function(t,o,i,n,s,a,l,r,h){let d=(f.ActionsToShow&u.Flows)===u.Flows,g=(f.ActionsToShow&u.Actions)===u.Actions,m=(f.ActionsToShow&u.BildrActions)===u.BildrActions,p=(f.ActionsToShow&u.MouseActions)===u.MouseActions;if(t){let o="V3gKt5FZRECIDMudjBbi3g"==t.id||"AGTUwIokUuQgXEgNW6mnA"==t.id||"CAGTUwIokUuQgXEgNW6mnA"==t.id,i="68"==t.type;if(o&&p||i&&d||!o&&!i&&g){let o;if(t.id&&!m){o=c.createInstance().actions.find((e=>e.id==t.id))}if(null!=o||m){let o=i?"Flow  ":"Action",n=i?"":"  --";console.log(`${o}: ${t.id} ${n}  "${t.name}"`),(f._StepMode||e&&t.id==e)&&(f._StepMode=!0)}}}window.orgQAFunc.call(this,t,o,i,n,s,a,l,r,h)},window.QueueAction.prototype=window.orgQAFunc.prototype,window.QueueAction.prototype.constructor=QueueAction}static Stop(){window.orgQAFunc&&(window.QueueAction=window.orgQAFunc)}static StepModeOff(){f._StepMode=!1}}f._StepMode=!1,f.ActionsToShow=u.Flows;class m{static findUnusedFlows(e=!0){let t=c.createInstance();const o=i(t.activePages);console.log(`Checking ${t.activeFlows.length} flows.`),console.log("You'll see 'That's it!' when checking is finished."),console.log(""),e?console.log("Looking for Unused flows (skipping unused 'Auto Save')"):console.log("Looking for All unused flows"),console.log(""),o.forEach((t=>{let o=!0;i(t.ActiveFlows).forEach((i=>{e&&i.name.includes("Auto Save")||0==m.findUsageOfFlow(i.id,!1)&&(o=n("Page : "+t.name,o),console.log("  Flow : "+i.name))}))})),console.log(""),console.log("THAT'S IT!")}static findUsageOfFlow(e,t=!0){let o=c.createInstance();const s=e.toString();let a=!1,l=o.activeFlows.find((t=>t.id==e));return l?(l.Page?n(`Flow "${l.name}" on page "${l.Page.name}" is called by:`,t):n(`Couldn't find page for flowID ${e} in project!`,t),n("",t),o.activePages.forEach((e=>{let o=t;i(e.ActiveFlows).forEach((i=>{i.Actions.forEach((c=>{c.id.toString().endsWith(s)?(a=!0,o=n("Page : "+e.name,o),n(`  Flow : ${i.name} (id: ${i.id})`,t),n("    as nested flow",t)):c.Arguments.forEach((l=>{if("static.actions"==l.argumentType){let r=l;"static.actions"==r.type&&r.value?.endsWith(s)&&(a=!0,o=n("Page : "+e.name,o),n(`  Flow : ${i.name} (id: ${i.id})`,t),n("    Action : "+c.name,t))}}))}))})),i(e.ActiveElements).forEach((i=>{let c=t;i.opts.events.filter((e=>e.actID&&e.actID.toString().endsWith(s))).forEach((s=>{a=!0,o=n("Page : "+e.name,o),c=n("  Element : "+i.name,c),n("    Event : "+s.code,t)}))}));let c=[];if(e.opts.autoSaveActionID?.toString().endsWith(s)&&c.push("Auto-Save Flow"),e.opts.onLoadAct?.toString().endsWith(s)&&c.push("Page Load Flow"),e.opts.notConnectedActID?.toString().endsWith(s)&&c.push("Flow to run when connection is lost"),e.opts.reConnectedActID?.toString().endsWith(s)&&c.push("Flow to run when connection is re-established"),e.opts.notAuthenticatedActID?.toString().endsWith(s)&&c.push("Flow to run when authentication is lost"),e.opts.newRevisionActID?.toString().endsWith(s)&&c.push("Flow to Run When Revision is Out of Date"),c.length>0&&(a=!0,o=n("Page : "+e.name,o),n("  Element : Page Body",t),c.forEach((e=>{n("    Event : "+e,t)}))),e.opts.resonanceDataListeners){let i=e.opts.resonanceDataListeners.filter((e=>e.actID&&e.actID.toString().endsWith(s)));i.length>0&&(a=!0,o=n("Page : "+e.name,o),n("  Element : Page Body",t),n(`    Used by ${i.length} Data Listener(s)`,t))}})),n("",t),n("THAT'S IT!",t),a):(n(`Couldn't find flowID ${e} in project!`,t),!1)}static findUsageOfDeletedFlows(){let e=c.createInstance();function t(t){return null!=e.deletedFlows.find((e=>e.id.toString().endsWith(t.toString())))}e.activeFlows.forEach((o=>{if(o.opts&&o.opts.arguments){let i=o.opts.arguments.find((e=>"actionsArray"==e.name));if(i){i.value?.forEach((i=>{if(i.id&&t(i.id)){let t=e.pages.find((e=>e.id==o.formID));if(t){console.log(`Page : ${t.name}`),console.log(`  Flow : ${o.name} (id: ${o.id})`);const n=e.deletedFlows.find((e=>e&&e.id.toString().endsWith(i.id.toString())));console.log(n)}}else{let n=e.actions.find((e=>e.id==i.id));if(n&&n.opts&&n.opts.arguments){if(n.opts.arguments.find((e=>"static.actions"==e.argumentType&&e.value&&t(e.value)))){let t=e.pages.find((e=>e.id==o.formID));t&&(console.log(`Page : ${t.name}`),console.log(`  Flow : ${o.name} (id: ${o.id})`),console.log(`    Action : ${n.name}`))}}}}))}}})),e.activePages.forEach((o=>{var n=Array();!function e(t){null!=t&&t.forEach((t=>{e(t.items),n.push(t)}))}(o.objsTree),i(n).forEach((o=>{if(o.opts&&o.opts.events){o.opts.events.filter((e=>e.actID&&t(e.actID))).forEach((t=>{let i=e.pages.find((e=>e.id==o.formID));i&&(console.log("Page : "+i.name),console.log("  Element : "+o.name),console.log("    Event : "+t.code))}))}}));let s=[];if(o.opts&&(o.opts.autoSaveActionID&&t(o.opts.autoSaveActionID)&&s.push("Auto-Save Flow"),o.opts.onLoadAct&&t(o.opts.onLoadAct)&&s.push("Page Load Flow"),o.opts.notConnectedActID&&t(o.opts.notConnectedActID)&&s.push("Flow to run when connection is lost"),o.opts.reConnectedActID&&t(o.opts.reConnectedActID)&&s.push("Flow to run when connection is re-established"),o.opts.notAuthenticatedActID&&t(o.opts.notAuthenticatedActID)&&s.push("Flow to run when authentication is lost"),o.opts.newRevisionActID&&t(o.opts.newRevisionActID)&&s.push("Flow to Run When Revision is Out of Date"),s.length>0&&(console.log("Page : "+o.name),console.log("  Element : Page Body"),s.forEach((e=>{console.log("    Event : "+e)}))),o.opts.resonanceDataListeners)){let e=o.opts.resonanceDataListeners.filter((e=>e.actID&&t(e.actID)));e.length>0&&(console.log("Page : "+o.name),console.log("  Element : Page Body"),console.log(`    Used by ${e.length} Data Listener(s)`))}})),console.log(""),console.log("THAT'S IT!")}static getFlowWithActions(e){let t=c.createInstance(),o=t.activeFlows.find((t=>t.id&&t.id.toString()==e));if(null!=o){if(console.log("Flow found:"),console.log(o),console.log("Actions:"),o.opts&&o.opts.arguments){let e=o.opts.arguments.find((e=>"actionsArray"==e.name));if(e){e.value?.forEach((e=>{let o=t.actions.find((t=>t.id.toString()==e.id.toString()));o&&console.log(o)}))}}}else console.log("flow not found")}}return t})()));
//# sourceMappingURL=bildr-tools.min.js.map